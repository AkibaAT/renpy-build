Changes to configure to allow crosscompiling for Darwin platforms.

From: Tom Rothamel <tom@rothamel.us>


---
 configure |   48 ++++++++++++++++--------------------------------
 1 file changed, 16 insertions(+), 32 deletions(-)

diff --git a/configure b/configure
index 2e7e0b7..a3c0eac 100755
--- a/configure
+++ b/configure
@@ -3334,6 +3334,7 @@ then
        # ac_sys_system and ac_sys_release are used for setting
        # a lot of different things including 'define_xopen_source'
        # in the case statement below.
+	ac_sys_release=
 	case "$host" in
 	*-*-linux-android*)
 		ac_sys_system=Linux-android
@@ -3347,12 +3348,15 @@ then
 	*-*-vxworks*)
 	    ac_sys_system=VxWorks
 	    ;;
+  *-*-darwin*)
+    ac_sys_system=Darwin
+    ac_sys_release=10.0
+    ;;
 	*)
 		# for now, limit cross builds to known configurations
 		MACHDEP="unknown"
 		as_fn_error $? "cross build not supported for $host" "$LINENO" 5
 	esac
-	ac_sys_release=
     else
 	ac_sys_system=`uname -s`
 	if test "$ac_sys_system" = "AIX" \
@@ -3396,7 +3400,16 @@ if test "$cross_compiling" = yes; then
 		;;
 	*-*-vxworks*)
 		_host_cpu=$host_cpu
-		;;
+  	;;
+  *-*-darwin*)
+    case "$host_cpu" in
+  		arm*)
+  			_host_cpu=arm
+  			;;
+  		*)
+  			_host_cpu=$host_cpu
+  		esac
+  		;;
 	*)
 		# for now, limit cross builds to known configurations
 		MACHDEP="unknown"
@@ -9507,36 +9520,7 @@ rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
 fi
 
 
-    if test "${ac_osx_32bit}" = "yes"; then
-    	case `/usr/bin/arch` in
-    	i386)
-    		MACOSX_DEFAULT_ARCH="i386"
-    		;;
-    	ppc)
-    		MACOSX_DEFAULT_ARCH="ppc"
-    		;;
-    	*)
-    		as_fn_error $? "Unexpected output of 'arch' on macOS" "$LINENO" 5
-    		;;
-    	esac
-    else
-    	case `/usr/bin/arch` in
-    	i386)
-    		MACOSX_DEFAULT_ARCH="x86_64"
-    		;;
-    	ppc)
-    		MACOSX_DEFAULT_ARCH="ppc64"
-		;;
-    	arm64)
-    		MACOSX_DEFAULT_ARCH="arm64"
-    		;;
-    	*)
-    		as_fn_error $? "Unexpected output of 'arch' on macOS" "$LINENO" 5
-    		;;
-    	esac
-
-    fi
-
+    MACOSX_DEFAULT_ARCH="$_host_cpu"
     LIBTOOL_CRUFT=$LIBTOOL_CRUFT" -lSystem -lSystemStubs -arch_only ${MACOSX_DEFAULT_ARCH}"
     LIBTOOL_CRUFT=$LIBTOOL_CRUFT' -install_name $(PYTHONFRAMEWORKINSTALLDIR)/Versions/$(VERSION)/$(PYTHONFRAMEWORK)'
     LIBTOOL_CRUFT=$LIBTOOL_CRUFT' -compatibility_version $(VERSION) -current_version $(VERSION)';;
